{% extends "layout.html" %}
{% block content %}

<h2 class="fw-bold mb-4 text-center">Modo Carrera FC26</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="card bg-secondary p-3 mb-4 shadow">
    <h5 class="text-light">Añadir Jugador</h5>
    <form method="POST" action="/add_player" class="row g-3">
        <div class="col-md-2">
            <select name="position" class="form-select" required>
                <option value="">Posición</option>
                {% for pos in ["POR", "LI", "CAI", "DFC", "LD", "CAD", "MCD", "MC", "MCO", "MI", "MD", "EI", "DC", "SD", "ED"] %}
                <option value="{{ pos }}">{{ pos }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2"><input name="name" class="form-control" placeholder="Nombre" required></div>
        <div class="col-md-1"><input name="age" type="number" class="form-control" placeholder="Edad" required></div>
        <div class="col-md-2"><input name="nationality" class="form-control" placeholder="Nacionalidad" required></div>
        <div class="col-md-1"><input name="grl" type="number" class="form-control" placeholder="GRL" required></div>
        <div class="col-md-1"><input name="matches" type="number" class="form-control" placeholder="Partidos"></div>
        <div class="col-md-1"><input name="goals" type="number" class="form-control" placeholder="Goles"></div>
        <div class="col-md-1"><input name="assists" type="number" class="form-control" placeholder="Asist."></div>
        <div class="col-md-1"><input name="market_value" type="number" step="0.1" class="form-control" placeholder="Valor (€M)" required></div>
        <div class="col-md-1"><input name="salary" type="number" step="0.1" class="form-control" placeholder="Sueldo (€M)" required></div>
        <div class="col-md-12 text-center">
            <button type="submit" class="btn btn-primary w-25">Guardar</button>
        </div>
    </form>
</div>

{% if total_players < 15 %}
<div class="alert alert-danger text-center">
    ⚠️ Tu plantilla tiene {{ total_players }} jugadores. Necesitas al menos 15.
</div>
{% endif %}

{% if players %}
<table class="table table-dark table-striped table-hover text-center align-middle shadow">
    <thead>
        <tr>
            <th>Posición</th>
            <th>Nombre</th>
            <th>Edad</th>
            <th>Nacionalidad</th>
            <th>GRL</th>
            <th>Partidos</th>
            <th>Goles</th>
            <th>Asistencias</th>
            <th>Valor (€M)</th>
            <th>Sueldo (€M)</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for player in players %}
        <tr>
            <td>{{ player.position }}</td>
            <td>{{ player.name }}</td>
            <td>{{ player.age }}</td>
            <td>{{ player.nationality }}</td>
            <td>{{ player.grl }}</td>
            <td>{{ player.matches }}</td>
            <td>{{ player.goals }}</td>
            <td>{{ player.assists }}</td>
            <td>{{ player.market_value }}</td>
            <td>{{ player.salary }}</td>
            <td><a href="/delete_player/{{ player.id }}" class="btn btn-sm btn-danger">Eliminar</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-center mt-3">Aún no tienes jugadores en tu plantilla.</p>
{% endif %}
{% endblock %}
